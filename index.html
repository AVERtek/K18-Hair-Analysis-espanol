<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WW6RN3Z');</script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N2Z2YBM61C"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-N2Z2YBM61C');
        gtag('config', 'UA-205255955-2');
    </script>

    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.js"></script>

    <style>
        body { background-color: #00BBB4; margin: 0; padding: 15px; font-family: -apple-system, sans-serif; }
        .container { column-count: 2; column-width: 400px; column-gap: 20px; }
        .card { break-inside: avoid; background-color: #00BBB4; border: 2px solid #00BBB9; padding: 5px; margin-bottom: 1em; position: relative; }
        .card-white { break-inside: avoid; background-color: #FFFFFF; border: 2px solid #00BBB9; padding: 5px; margin-bottom: 1em; position: relative; }
        
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 10;
            display: flex; justify-content: center; align-items: center; cursor: pointer; border-radius: 8px;
        }
        #overlay.hide { display: none; }
        .play-trigger { background: #ff595a; color: white; border: 1px solid white; padding: 12px 24px; border-radius: 8px; font-weight: bold; }

        .ar-button { 
            background-color: #ff595a; border-radius: 8px; border: 1px solid white; 
            position: absolute; top: 10px; right: 10px; height: 40px; 
            color: white; padding: 0 15px; cursor: pointer; z-index: 15; font-weight: bold;
        }

        model-viewer { width: 100%; height: 500px; --poster-color: transparent; }
        .marginauto { margin: 10px auto; display: block; }
        .centerImage { text-align: center; display: block; }
    </style>
</head>

<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WW6RN3Z" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    <div class="container">
        <div class="card">
            <img class="marginauto" src="images/K18_Logo_White.png" alt="Logo" style="height: 100px; width: auto"> 
        </div>

        <div class="card-white">
            <div id="overlay" onclick="startExperience()">
                <div class="play-trigger">HAGA CLIC PARA EMPEZAR</div>
            </div>

            <model-viewer id="sync-model" 
                src="Models/K18_TEST_Ver.5.glb" 
                ios-src="Models/AR_57seconds_withoutBanner_WithAudio.usdz#allowsScaling=1"
                ar 
                ar-modes="webxr quick-look scene-viewer" 
                ar-preferred
                ar-scale="any" 
                camera-controls 
                autoplay
                interaction-prompt="none">
                
                <button slot="ar-button" class="ar-button" id="ar-launcher">
                    üëÜ <strong>AR CLIC AQU√ç</strong>
                </button>
            </model-viewer>
        </div>

        <div class="card" style="text-align: center;">
            <h3 style="color: white;"><b>ESCUCHA LA NARRACI√ìN</b></h3>
            <audio id="sound" style="width: 100%;" controls>
                <source src="Sound/Spanish 139 sec.m4a" type="audio/mp4">
            </audio>
        </div>

        <div class="centerImage">   
            <button onclick="location.href='https://avertek.github.io/K18-Hair-Analysis/'" 
                    style="background-color: #ff595a; border-radius: 8px; border: 1px solid white; height: 35px; color:#FFFFFF; padding: 0 15px; cursor: pointer;">
                <strong>IN ENGLISH</strong>
            </button> 
        </div>

        <div class="card" style="text-align: center;">
            <h2 style="color:#FFFFFF;"><b>¬øNO PUEDES TENER SUFICIENTE?</b></h2>
            <button onclick="location.href='https://www.k18hair.com/pages/our-science'" 
                style="background-color: #ff595a; border-radius: 8px; border: 1px solid white; height: 35px; width: 250px; color:#FFFFFF; margin: 5px; cursor: pointer;">
                <strong>C√ìMO FUNCIONA K18</strong>
            </button> 
            <button onclick="location.href='https://www.instagram.com/k18hair/?hl=en'" 
                style="background-color: #ff595a; border-radius: 8px; border: 1px solid white; height: 35px; width: 250px; color:#FFFFFF; margin: 5px; cursor: pointer;">
                <strong>√öNETE A NUESTRA CRUZADA</strong>
            </button> 
        </div>

        <div class="card">
            <img class="marginauto" src="images/K18 Symbology Sheet 2x3fr750.png" style="max-width: 100%"> 
        </div>

        <div class="card" style="text-align: center; color: white;">
            <p><em>Si el bot√≥n AR no aparece, use otro navegador</em></p>
            <a href="https://avertek.net/" style="color: white; text-decoration: underline;">Obtenga m√°s informaci√≥n sobre XR-NOW de AVERtek</a>
        </div>
    </div>

    <script>
        const modelViewer = document.querySelector("#sync-model");
        const audio = document.querySelector("#sound");
        const overlay = document.querySelector("#overlay");
        const arLauncher = document.querySelector("#ar-launcher");

        // Swap to Spanish AR GLB on click
        arLauncher.addEventListener('click', () => {
            modelViewer.src = "Models/AR_57seconds_withoutBanner.glb?sound=Sound/Spanish 57 sec.m4a";
        });

        // Reset to original 2D version on return
        modelViewer.addEventListener('ar-status', (event) => {
            if (event.detail.status === 'not-presenting') {
                modelViewer.src = "Models/K18_TEST_Ver.5.glb";
                setTimeout(() => {
                    modelViewer.currentTime = audio.currentTime;
                    if (!audio.paused) modelViewer.play();
                }, 600);
            }
        });

        function startExperience() {
            overlay.classList.add("hide");
            audio.play();
            modelViewer.play();
        }

        // Scrubbing sync logic
        audio.addEventListener("timeupdate", () => {
            if (!isNaN(audio.currentTime) && modelViewer.src.includes("Ver.5")) {
                modelViewer.currentTime = audio.currentTime;
            }
        });

        audio.addEventListener("play", () => modelViewer.play());
        audio.addEventListener("pause", () => modelViewer.pause());
    </script>
</body>
</html>
